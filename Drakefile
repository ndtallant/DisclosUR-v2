; Drakefile for DisclosUR
; Downloads OpenStates data
; Downloads CPI data
; Runs OpenCorporates API calls
; Loads all into Postgres

;;;  LOAD POSTGRES ENVIRONMENT VARIABLES  ;;;

;PROFILE:=default_profile
;%include $[PROFILE]


;;;  DOWNLOAD AND UNZIP OPENSTATES DATA  ;;;

data <- [-timecheck] 
  mkdir data && cd data
  mkdir zips && cd ..

data/zips/al.zip <- [-timecheck] 
  curl -s https://data.openstates.org/legacy/csv/al.zip -o data/zips/al.zip

data/zips/ak.zip <- [-timecheck] 
  curl -s https://data.openstates.org/legacy/csv/ak.zip -o data/zips/ak.zip

data/zips/az.zip <- [-timecheck] 
  curl -s https://data.openstates.org/legacy/csv/az.zip -o data/zips/az.zip

data/zips/ar.zip <- [-timecheck] 
  curl -s https://data.openstates.org/legacy/csv/ar.zip -o data/zips/ar.zip



;;; LOAD THE DATA  ;;;

;  Postgres database doesn't have a timestamp we can check,
;  we create a fake file that tracks the timestamp.
;
;  `psql -f` runs the commands in the file
;  `touch` updates the timestamp on the file or 
;   creates an empty file if the file doesn't exist
;  `&&` the second command only runs if the first command finishes


