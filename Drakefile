; Drakefile for DisclosUR
; Downloads OpenStates data
; Downloads CPI data
; Runs OpenCorporates API calls
; Loads all into Postgres

;;;  LOAD POSTGRES ENVIRONMENT VARIABLES  ;;;

;PROFILE:=default_profile
;%include $[PROFILE]

data <- [-timecheck] 
  mkdir data && cd data
  mkdir zips && cd ..

;;;  DOWNLOAD AND UNZIP OPENSTATES DATA  ;;;

data/zips/al.zip <- [-timecheck] 
  curl -s https://data.openstates.org/legacy/csv/al.zip -o data/zips/al.zip

data/zips/ak.zip <- [-timecheck] 
  curl -s https://data.openstates.org/legacy/csv/ak.zip -o data/zips/ak.zip

data/zips/az.zip <- [-timecheck] 
  curl -s https://data.openstates.org/legacy/csv/az.zip -o data/zips/az.zip

data/zips/ar.zip <- [-timecheck] 
  curl -s https://data.openstates.org/legacy/csv/ar.zip -o data/zips/ar.zip

data/zips/ca.zip <- [-timecheck] 
  curl -s https://data.openstates.org/legacy/csv/ca.zip -o data/zips/ca.zip

data/zips/co.zip <- [-timecheck] 
  curl -s https://data.openstates.org/legacy/csv/co.zip -o data/zips/co.zip

data/zips/ct.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/ct.zip -o data/zips/ct.zip

data/zips/de.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/de.zip -o data/zips/de.zip

data/zips/dc.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/dc.zip -o data/zips/dc.zip

data/zips/fl.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/fl.zip -o data/zips/fl.zip

data/zips/ga.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/ga.zip -o data/zips/ga.zip

data/zips/hi.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/hi.zip -o data/zips/hi.zip

data/zips/id.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/id.zip -o data/zips/id.zip

data/zips/il.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/il.zip -o data/zips/il.zip

data/zips/in.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/in.zip -o data/zips/in.zip

data/zips/ia.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/ia.zip -o data/zips/ia.zip

data/zips/ks.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/ks.zip -o data/zips/ks.zip
      
data/zips/ky.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/ky.zip -o data/zips/ky.zip
      
data/zips/la.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/la.zip -o data/zips/la.zip

data/zips/me.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/me.zip -o data/zips/me.zip
      
data/zips/md.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/md.zip -o data/zips/md.zip

data/zips/ma.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/ma.zip -o data/zips/ma.zip

data/zips/mi.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/mi.zip -o data/zips/mi.zip
      
data/zips/mn.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/mn.zip -o data/zips/mn.zip
      
data/zips/ms.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/ms.zip -o data/zips/ms.zip
      
data/zips/mo.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/mo.zip -o data/zips/mo.zip

data/zips/mt.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/mt.zip -o data/zips/mt.zip

data/zips/ne.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/ne.zip -o data/zips/ne.zip

data/zips/nv.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/nv.zip -o data/zips/nv.zip

data/zips/nh.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/nh.zip -o data/zips/nh.zip

data/zips/nj.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/nj.zip -o data/zips/nj.zip

data/zips/nm.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/nm.zip -o data/zips/nm.zip

data/zips/ny.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/ny.zip -o data/zips/ny.zip

data/zips/nc.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/nc.zip -o data/zips/nc.zip

data/zips/nd.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/nd.zip -o data/zips/nd.zip

data/zips/oh.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/oh.zip -o data/zips/oh.zip

data/zips/ok.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/ok.zip -o data/zips/ok.zip

data/zips/or.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/or.zip -o data/zips/or.zip

data/zips/pa.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/pa.zip -o data/zips/pa.zip

data/zips/pr.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/pr.zip -o data/zips/pr.zip

data/zips/ri.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/ri.zip -o data/zips/ri.zip

data/zips/sc.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/sc.zip -o data/zips/sc.zip

data/zips/sd.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/sd.zip -o data/zips/sd.zip

data/zips/tn.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/tn.zip -o data/zips/tn.zip

data/zips/tx.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/tx.zip -o data/zips/tx.zip

data/zips/ut.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/ut.zip -o data/zips/ut.zip

data/zips/vt.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/vt.zip -o data/zips/vt.zip

data/zips/va.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/va.zip -o data/zips/va.zip
      
data/zips/wa.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/wa.zip -o data/zips/wa.zip

data/zips/wv.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/wv.zip -o data/zips/wv.zip
      
data/zips/wi.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/wi.zip -o data/zips/wi.zip
      
data/zips/wy.zip <- [-timecheck]
  curl -s https://data.openstates.org/legacy/csv/wy.zip -o data/zips/wy.zip

;;; UNZIP ;;;

data/al_legislators.csv <- [-timecheck]
  unzip data/zips/al.zip al_legislators.csv -d ./data

data/ak_legislators.csv <- [-timecheck]
  unzip data/zips/ak.zip ak_legislators.csv -d ./data

data/az_legislators.csv <- [-timecheck]
  unzip data/zips/az.zip az_legislators.csv -d ./data

data/ar_legislators.csv <- [-timecheck]
  unzip data/zips/ar.zip ar_legislators.csv -d ./data

data/ca_legislators.csv <- [-timecheck]
  unzip data/zips/ca.zip ca_legislators.csv -d ./data

data/co_legislators.csv <- [-timecheck]
  unzip data/zips/co.zip co_legislators.csv -d ./data

data/ct_legislators.csv <- [-timecheck]
  unzip data/zips/ct.zip ct_legislators.csv -d ./data

data/de_legislators.csv <- [-timecheck]
  unzip data/zips/de.zip de_legislators.csv -d ./data

data/dc_legislators.csv <- [-timecheck]
  unzip data/zips/dc.zip dc_legislators.csv -d ./data

data/fl_legislators.csv <- [-timecheck]
  unzip data/zips/fl.zip fl_legislators.csv -d ./data

data/ga_legislators.csv <- [-timecheck]
  unzip data/zips/ga.zip ga_legislators.csv -d ./data

data/hi_legislators.csv <- [-timecheck]
  unzip data/zips/hi.zip hi_legislators.csv -d ./data

data/id_legislators.csv <- [-timecheck]
  unzip data/zips/id.zip id_legislators.csv -d ./data

data/il_legislators.csv <- [-timecheck]
  unzip data/zips/il.zip il_legislators.csv -d ./data

data/in_legislators.csv <- [-timecheck]
  unzip data/zips/in.zip in_legislators.csv -d ./data

data/ia_legislators.csv <- [-timecheck]
  unzip data/zips/ia.zip ia_legislators.csv -d ./data

data/ks_legislators.csv <- [-timecheck]
  unzip data/zips/ks.zip ks_legislators.csv -d ./data

data/ky_legislators.csv <- [-timecheck]
  unzip data/zips/ky.zip ky_legislators.csv -d ./data

data/la_legislators.csv <- [-timecheck]
  unzip data/zips/la.zip la_legislators.csv -d ./data

data/me_legislators.csv <- [-timecheck]
  unzip data/zips/me.zip me_legislators.csv -d ./data

data/md_legislators.csv <- [-timecheck]
  unzip data/zips/md.zip md_legislators.csv -d ./data

data/ma_legislators.csv <- [-timecheck]
  unzip data/zips/ma.zip ma_legislators.csv -d ./data

data/mi_legislators.csv <- [-timecheck]
  unzip data/zips/mi.zip mi_legislators.csv -d ./data

data/mn_legislators.csv <- [-timecheck]
  unzip data/zips/mn.zip mn_legislators.csv -d ./data

data/ms_legislators.csv <- [-timecheck]
  unzip data/zips/ms.zip ms_legislators.csv -d ./data

data/mo_legislators.csv <- [-timecheck]
  unzip data/zips/mo.zip mo_legislators.csv -d ./data

data/mt_legislators.csv <- [-timecheck]
  unzip data/zips/mt.zip mt_legislators.csv -d ./data

data/ne_legislators.csv <- [-timecheck]
  unzip data/zips/ne.zip ne_legislators.csv -d ./data

data/nv_legislators.csv <- [-timecheck]
  unzip data/zips/nv.zip nv_legislators.csv -d ./data

data/nh_legislators.csv <- [-timecheck]
  unzip data/zips/nh.zip nh_legislators.csv -d ./data

data/nj_legislators.csv <- [-timecheck]
  unzip data/zips/nj.zip nj_legislators.csv -d ./data

data/nm_legislators.csv <- [-timecheck]
  unzip data/zips/nm.zip nm_legislators.csv -d ./data

data/ny_legislators.csv <- [-timecheck]
  unzip data/zips/ny.zip ny_legislators.csv -d ./data

data/nc_legislators.csv <- [-timecheck]
  unzip data/zips/nc.zip nc_legislators.csv -d ./data

data/nd_legislators.csv <- [-timecheck]
  unzip data/zips/nd.zip nd_legislators.csv -d ./data

data/oh_legislators.csv <- [-timecheck]
  unzip data/zips/oh.zip oh_legislators.csv -d ./data

data/ok_legislators.csv <- [-timecheck]
  unzip data/zips/ok.zip ok_legislators.csv -d ./data

data/or_legislators.csv <- [-timecheck]
  unzip data/zips/or.zip or_legislators.csv -d ./data

data/pa_legislators.csv <- [-timecheck]
  unzip data/zips/pa.zip pa_legislators.csv -d ./data

data/pr_legislators.csv <- [-timecheck]
  unzip data/zips/pr.zip pr_legislators.csv -d ./data

data/ri_legislators.csv <- [-timecheck]
  unzip data/zips/ri.zip ri_legislators.csv -d ./data

data/sc_legislators.csv <- [-timecheck]
  unzip data/zips/sc.zip sc_legislators.csv -d ./data

data/sd_legislators.csv <- [-timecheck]
  unzip data/zips/sd.zip sd_legislators.csv -d ./data

data/tn_legislators.csv <- [-timecheck]
  unzip data/zips/tn.zip tn_legislators.csv -d ./data

data/tx_legislators.csv <- [-timecheck]
  unzip data/zips/tx.zip tx_legislators.csv -d ./data

data/ut_legislators.csv <- [-timecheck]
  unzip data/zips/ut.zip ut_legislators.csv -d ./data

data/vt_legislators.csv <- [-timecheck]
  unzip data/zips/vt.zip vt_legislators.csv -d ./data

data/va_legislators.csv <- [-timecheck]
  unzip data/zips/va.zip va_legislators.csv -d ./data

data/wa_legislators.csv <- [-timecheck]
  unzip data/zips/wa.zip wa_legislators.csv -d ./data

data/wv_legislators.csv <- [-timecheck]
  unzip data/zips/wv.zip wv_legislators.csv -d ./data

data/wi_legislators.csv <- [-timecheck]
  unzip data/zips/wi.zip wi_legislators.csv -d ./data

data/wy_legislators.csv <- [-timecheck]
  unzip data/zips/wy.zip wy_legislators.csv -d ./data

;;; DISTRICTS BY COUNTY ;;;
data/districts_by_county.csv <- [-timecheck]
  python scripts/districts.py

;;; CPI DATA ;;;
data/zips/state_lawmaker_disclosures.zip <- [-timecheck]
  curl -s https://github.com/PublicI/state-lawmakers-disclosures/archive/master.zip -o data/zips/state_lawmaker_disclosures.zip

;;; LOAD THE DATA  ;;;

;  Postgres database doesn't have a timestamp we can check,
;  we create a fake file that tracks the timestamp.
;
;  `psql -f` runs the commands in the file
;  `touch` updates the timestamp on the file or 
;   creates an empty file if the file doesn't exist
;  `&&` the second command only runs if the first command finishes
